{
  "app-id": "org.ardour.Ardour",
  "sdk": "org.freedesktop.Sdk",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "25.08",
  "command": "ardour9",
  "rename-appdata-file": "ardour9.appdata.xml",
  "rename-desktop-file": "ardour9.desktop",
  "rename-icon": "ardour9",
  "rename-mime-file": "ardour.xml",
  "rename-mime-icons": [
     "application-x-ardour"
  ],
  "finish-args": [
    "--share=ipc",
    "--socket=wayland",
    "--socket=fallback-x11",
    "--socket=pulseaudio",
    "--device=all",
    "--filesystem=home",
    "--share=network",
    "--env=ALSA_CONFIG_PATH=",
    "--own-name=org.freedesktop.ReserveDevice1.*",
    "--filesystem=xdg-run/pipewire-0",
    "--env=TMPDIR=/var/tmp",
    "--env=LXVST_PATH=/app/extensions/Plugins/vst",
    "--env=VST3_PATH=/app/extensions/Plugins/vst3",
    "--env=LADSPA_PATH=/app/extensions/Plugins/ladspa:/app/lib/ladspa"
  ],
  "add-extensions": {
    "org.freedesktop.LinuxAudio.Plugins": {
      "directory": "extensions/Plugins",
      "version": "25.08",
      "add-ld-path": "lib",
      "merge-dirs": "ladspa;lv2;vst;vst3",
      "subdirectories": true,
      "no-autodownload": true
    }
  },
  "cleanup": [
    "/include",
    "/lib/pkgconfig",
    "/share/info"
  ],
  "modules": [
        {
            "name": "sigc++-2",
            "cleanup": [
                "/include",
                "/lib/sigc++-2.0"
            ],
            "build-options": {
                "cxxflags": "-std=gnu++14"
            },
            "config-opts" : [
                "--disable-documentation"
            ],
            "sources" : [
                {
                    /* Ardour */
                    "type" : "archive",
                    "url" : "https://download.gnome.org/sources/libsigc++/2.10/libsigc++-2.10.2.tar.xz",
                    "sha256" : "b1ca0253379596f9c19f070c83d362b12dfd39c0a3ea1dd813e8e21c1a097a98"
                }
            ]
        },
        {
            "name": "cairomm",
            "build-options": {
                "cxxflags": "-std=gnu++14"
            },
            "config-opts" : [
                "--disable-documentation"
            ],
            "cleanup": [
                "/include",
                "/lib/cairomm-1.0",
                "*.la"
            ],
            "sources": [
                {
                    /* Ardour */
                    "type": "archive",
                    "url": "http://cairographics.org/releases/cairomm-1.12.2.tar.gz",
                    "sha256": "45c47fd4d0aa77464a75cdca011143fea3ef795c4753f6e860057da5fb8bd599"
                }
            ]
        },
        {
            "name": "glibmm",
            "build-options": {
                "cxxflags": "-std=gnu++14"
            },
            "config-opts" : [
                "--disable-documentation"
            ],
            "cleanup": [
                "/include",
                "/lib/giomm-2.4",
                "/lib/glibmm-2.4",
                "/lib/*.so",
                "*.la"
            ],
            "sources": [
                {
                    /* Ardour */
                    "type": "archive",
                    "url": "https://download.gnome.org/sources/glibmm/2.56/glibmm-2.56.1.tar.xz",
                    "sha256" : "dac6872058adde263b7eb0bef07263ba65abb5abc7fd4ca337e81cc5d5f9ca87"
                }
            ]
        },
        {
            "name": "pangomm",
            "cleanup": [
                "/include",
                "/lib/pangomm-1.4"
            ],
            "build-options": {
                "cxxflags": "-std=gnu++14"
            },
            "config-opts" : [
                "--disable-documentation"
            ],
            "sources": [
                {
                    /* Ardour */
                    "type": "archive",
                    "url": "https://download.gnome.org/sources/pangomm/2.42/pangomm-2.42.0.tar.xz",
                    "sha256": "ca6da067ff93a6445780c0b4b226eb84f484ab104b8391fb744a45cbc7edbf56"
                },
                {
                    "type": "patch",
                    "path": "patches/pangomm-api.patch"
                }
            ]
        },
    {
      "name" : "boost",
      "buildsystem" : "simple",
      "cleanup" : [
        "/include",
        "/lib/libboost_*.so*",
        "/lib/libboost_*.a"
      ],
      "build-commands" : [
        "./bootstrap.sh --with-libraries=atomic",
        "./b2 install variant=release link=shared runtime-link=shared --prefix=/app -j $FLATPAK_BUILDER_N_JOBS"
      ],
      "sources" : [
        {
          "type" : "archive",
          "url" : "https://downloads.sourceforge.net/project/boost/boost/1.84.0/boost_1_84_0.tar.bz2",
          "sha256" : "cc4b893acf645c9d4b698e9a0f08ca8846aa5d6c68275c14c3e7949c24109454"
        }
      ]
    },
    {
      "name": "lrdf",
      "rm-configure": true,
      "cleanup": [
        "/include",
        "/share/man",
        "/lib/pkgconfig",
        "*.a"
      ],
      "modules": [
        {
          "name": "raptor2",
          "cleanup": [
            "/include",
            "/lib/pkgconfig",
            "/share/gtk-doc"
          ],
          "config-opts": [
            "--disable-documentation",
            "--disable-static"
          ],
          "sources": [
            {
              /* Ardour */
              "type": "archive",
              "url": "https://download.librdf.org/source/raptor2-2.0.16.tar.gz",
              "sha256": "089db78d7ac982354bdbf39d973baf09581e6904ac4c92a98c5caadb3de44680"
            },
            {
                "type": "patch",
                "path": "shared-modules/linux-audio/patches/raptor-libxml.patch"
            }
          ]
        }
      ],
      "sources": [
        {
          /* Ardour */
          "type": "archive",
          "url": "https://github.com/x42/LRDF/archive/0.5.1-rg.tar.gz",
          "sha256": "0ea638dea753ac54b5f19fb8a99ed6f64978b47ba7ee1eaf75377f9956f4ae4c"
        },
        {
          "type": "script",
          "commands": [
            "rm -fr m4",
            "autoreconf -fiv"
          ],
          "dest-filename": "autogen.sh"
        }
      ]
    },
    {
      "name": "liblo",
      "cleanup": [
        "/bin",
        "/include",
        "/lib/pkgconfig",
        "*.la",
        "*.so"
      ],
      "build-options": {
          "cflags": "-Wno-error=stringop-truncation -Wno-error=maybe-uninitialized",
          "cxxflags": "-Wno-error=stringop-truncation -Wno-error=maybe-uninitialized"
      },
      "sources": [
        {
          /* Ardour */
          "type": "archive",
          "url": "http://download.sf.net/sourceforge/liblo/liblo-0.28.tar.gz",
          "sha256": "da94a9b67b93625354dd89ff7fe31e5297fc9400b6eaf7378c82ee1caf7db909"
        }
      ]
    },
    {
      "name": "lv2",
      "buildsystem": "meson",
      "cleanup": [
        "/bin",
        "/include",
        "/lib/pkgconfig",
        "/share"
      ],
      "sources": [
        {
          /* Ardour */
          "type": "archive",
          "url": "https://lv2plug.in/spec/lv2-1.18.10.tar.xz",
          "sha256": "78c51bcf21b54e58bb6329accbb4dae03b2ed79b520f9a01e734bd9de530953f"
        }
      ]
    },
    {
      "name": "sndfile",
      "build-options": {
        "cflags": "-std=c18"
      },
      "cleanup": [
        ".a"
      ],
      "sources": [
        {
          /* Ardour - version for Opus support */
          "type": "archive",
          "url": "http://ardour.org/files/deps/libsndfile-1.1.0-41-gd8503a66.tar.xz",
          "sha256": "a1fb3f96588f700fa04de20e9516004231ffdc87f080e3faaa1a97571e639c7a"
        }
      ]
    },
    {
      "name": "taglib",
      "buildsystem": "cmake-ninja",
      "config-opts": [
        "-DCMAKE_POLICY_VERSION_MINIMUM=3.5",
        "-DBUILD_SHARED_LIBS=ON"
      ],
      "cleanup": [
        "/include",
        "/lib/pkgconfig",
        "/lib/*.so"
      ],
      "sources": [
        {
          /* Ardour */
          "type": "archive",
          "url": "https://taglib.org/releases/taglib-2.0.tar.gz",
          "sha256": "e36ea877a6370810b97d84cf8f72b1e4ed205149ab3ac8232d44c850f38a2859"
        }
      ]
    },
    {
      "name": "vamp-plugin-sdk",
      "no-parallel-make": true,
      "sources": [
        {
          /* Ardour */
          "type": "archive",
          "url": "https://github.com/vamp-plugins/vamp-plugin-sdk/archive/refs/tags/vamp-plugin-sdk-v2.10.tar.gz",
          "sha256": "b552bc91817294c7f90ea07d70938642ebf15d5e3bafc81cf7d55efab9995399"
        }
      ],
      "cleanup": [
        "/bin",
        "/include",
        "/lib/pkgconfig",
        "*.a"
      ]
    },
    {
      "name": "rubberband",
      "buildsystem": "meson",
      "build-options": {
        "env": {
          "Vamp_CFLAGS": " ",
          "Vamp_LIBS": " "
        }
      },
      "config-opts": [
        "-Dfft=fftw"
      ],
      "sources": [
        {
          /* Ardour */
          "type": "archive",
          "url": "http://breakfastquay.com/files/releases/rubberband-3.3.0.tar.bz2",
          "sha256": "d9ef89e2b8ef9f85b13ac3c2faec30e20acf2c9f3a9c8c45ce637f2bc95e576c"
        }
      ],
      "cleanup": [
        "/bin",
        "/include",
        "/share/ladspa",
        "*.a",
        "*.so"
      ]
    },
    {
      "name": "fftw3f",
      "config-opts": [
        "--enable-threads",
        "--enable-shared",
        "--disable-static",
        "--enable-float"
      ],
      "build-options": {
        "arch": {
          "x86_64": {
            "config-opts": [
              "--enable-sse2",
              "--enable-avx",
              "--enable-avx-128-fma"
            ]
          },
          "aarch64": {
            "config-opts": [
              "--enable-neon"
            ]
          }
        }
      },
      "sources": [
        {
          /* Ardour */
          "type": "archive",
          "url": "http://www.fftw.org/fftw-3.3.10.tar.gz",
          "sha256": "56c932549852cddcfafdab3820b0200c7742675be92179e59e6215b340e26467"
        }
      ],
      "cleanup": [
        "/bin",
        "/include",
        "/lib/cmake",
        "/lib/pkgconfig",
        "/share/man",
        "*.la",
        "*.so"
      ]
    },
    {
      "name": "aubio",
      "buildsystem": "autotools",
      "cleanup": [
        "/bin",
        "/include",
        "/lib/pkgconfig",
        "*.a"
      ],
      "build-options": {
        "ldflags": "-lm"
      },
      "sources": [
        {
          /* Ardour */
          "type": "archive",
          "url": "http://aubio.org/pub/aubio-0.3.2.tar.gz",
          "sha256": "dc1387b048610a6141f523c27314b7a60bd299c3d6789c372445ddc6511512cd"
        },
        {
          "type": "shell",
          "commands": [
            "cp -p /usr/share/automake-*/config.{sub,guess} ."
          ]
        }
      ]
    },
    {
      "name": "libusb",
      "cleanup": [
        "/include",
        "/lib/pkgconfig",
        "*.la",
        "*.so"
      ],
      "no-parallel-make": true,
      "config-opts": [
          "--disable-static",
          "--disable-udev"
      ],
      "sources": [
        {
          /* Ardour */
          "type": "archive",
          "url": "https://github.com/libusb/libusb/releases/download/v1.0.20/libusb-1.0.20.tar.bz2",
          "sha256" : "cb057190ba0a961768224e4dc6883104c6f945b2bf2ef90d7da39e7c1834f7ff"
        }
      ]
    },
    {
      "name": "lilv",
      "buildsystem": "meson",
      "modules": [
        {
          "name": "serd",
          "buildsystem": "meson",
          "sources": [
            {
              /* Ardour */
              "type": "archive",
              "url": "https://download.drobilla.net/serd-0.32.6.tar.xz",
              "sha256": "0fbe094952fe176ba4da4f2f767ddfb5f60e67e64d1761b4383a0b872cfd071a"
            }
          ],
          "cleanup": [
            "/bin",
            "/include",
            "/lib/pkgconfig",
            "/share/man"
          ]
        },
        {
          "name": "sord",
          "buildsystem": "meson",
          "sources": [
            {
              /* Ardour */
              "type": "archive",
              "url": "https://download.drobilla.net/sord-0.16.20.tar.xz",
              "sha256": "508b41d6b4f9d5902c9f5b9cf25170d9d0636f68f11bd257c1150497f754a2a4"
            }
          ],
          "cleanup": [
            "/bin",
            "/include",
            "/lib/pkgconfig",
            "/share/man"
          ]
        },
        {
          "name": "sratom",
          "buildsystem": "meson",
          "cleanup": [
            "/include",
            "/lib/pkgconfig"
          ],
          "sources": [
            {
              /* Ardour */
              "type": "archive",
              "url": "https://download.drobilla.net/sratom-0.6.22.tar.xz",
              "sha256": "0209b7d0f22c96abb416722ed735b0933be47931ecff4aa4b26ded7760b4f252"
            }
          ]
        }
      ],
      "sources": [
        {
          /* Ardour */
          "type": "archive",
          "url": "https://download.drobilla.net/lilv-0.26.4.tar.xz",
          "sha256": "1c8b5fcb78718173e67d76e51ad423f5113a9ff68463f2566195ae46396089e3"
        }
      ],
      "cleanup": [
        "/bin",
        "/etc",
        "/include",
        "/lib/pkgconfig",
        "/share/man"
      ]
    },
    {
      "name": "libwebsockets",
      "buildsystem": "cmake-ninja",
      "cleanup": [
        "/bin",
        "/include",
        "/lib/cmake",
        "/share/libwebsockets-test-server",
        "*.a",
        "*.so"
      ],
      "build-options": {
        "cflags": "-Wno-error=deprecated-declarations"
      },
      "config-opts": [
        "-DCMAKE_POLICY_VERSION_MINIMUM=3.5",
        "-DLWS_WITH_EXTERNAL_POLL=ON"
      ],
      "sources": [
        {
          /* Ardour */
          "type": "archive",
          "url": "http://ardour.org/files/deps/libwebsockets-4.3.0-14.tar.gz",
          "sha256": "929de090e13a36719fc4df04dad2a667eff694987bc26bdd5f01d69374e90710"
        },
        {
          "type": "patch",
          "path": "patches/libwebsocket-build.patch"
        }
      ]
    },
    {
      "name": "ffmpeg",
      "config-opts": [
        "--enable-libopus",
        "--enable-libmp3lame",
        "--enable-shared",
        "--disable-static",
        "--enable-gnutls",
        "--disable-doc"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://ffmpeg.org/releases/ffmpeg-7.1.tar.xz",
          "sha256": "40973d44970dbc83ef302b0609f2e74982be2d85916dd2ee7472d30678a7abe6"
        }
      ],
      "cleanup": [
        "/share/ffmpeg/examples"
      ]
    },
    {
      "name": "xjadeo",
      "cleanup": [
        "/share/man"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://downloads.sourceforge.net/project/xjadeo/xjadeo/v0.8.15/xjadeo-0.8.15.tar.gz",
          "sha256": "54b3bc321b101bf73bd79da1013c6f95afc64312c70bdf745d8093cb1d52ef80"
        },
        {
            "type": "patch",
            "path": "patches/xjadeo-gcc14.patch"
        }
      ]
    },
    {
      "name": "harvid",
      "buildsystem": "simple",
      "build-options": {
        "env": {
          "PREFIX": "${FLATPAK_DEST}"
        }
      },
      "build-commands": [
        "make",
        "make install"
      ],
      "cleanup": [
        "/share/man"
      ],
      "post-install": [
        "ln -s ${FLATPAK_DEST}/bin/ffmpeg ${FLATPAK_DEST}/bin/ffmpeg_harvid",
        "ln -s ${FLATPAK_DEST}/bin/ffprobe ${FLATPAK_DEST}/bin/ffprobe_harvid"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/x42/harvid/archive/v0.9.1.tar.gz",
          "sha256": "6a3c881644b4c044d01ebd06bc8388b2f85764d7f1efac4a3cdeac9858f156a5"
        },
        {
          "type": "patch",
          "path": "patches/harvid-gcc14.patch"
        }
      ]
    },
    {
      "name": "ardour",
      "buildsystem": "simple",
      "build-options": {
          "cppflags": "-DGLIB_VERSION_MAX_ALLOWED=GLIB_VERSION_2_56 -DGLIB_VERSION_MIN_REQUIRED=GLIB_VERSION_2_56"
      },
      "build-commands": [
        "python3 ./waf configure --prefix=/app --optimize --dist-target=$FLATPAK_ARCH --debug-symbols --no-phone-home --freedesktop --with-backends=alsa,dummy,pulseaudio,jack",
        "python3 ./waf build -j $FLATPAK_BUILDER_N_JOBS",
        "python3 ./waf i18n -j $FLATPAK_BUILDER_N_JOBS",
        "python3 ./waf install"
      ],
      "cleanup": [
        "*.a"
      ],
      "post-install": [
        "for s in 16 22 32 48; do install -Dpm644 /app/share/ardour9/icons/application-x-ardour_${s}px.png /app/share/icons/hicolor/${s}x${s}/mimetypes/application-x-ardour.png ; done",
        "desktop-file-edit --remove-category=AudioEditing --add-category=X-AudioEditing --set-icon=${FLATPAK_ID} /app/share/applications/ardour9.desktop",
        "install -d /app/extensions/Plugins",
        "sed -e '7i export LV2_PATH=${LV2_PATH:-$HOME/.lv2:/app/extensions/Plugins/lv2:/app/lib/lv2}' -i /app/bin/ardour9",
        "unzip -d ${FLATPAK_DEST}/share/ardour9/media ArdourBundledMedia.zip"
      ],
      "sources": [
        {
          "type": "git",
          "url": "https://github.com/Ardour/ardour.git",
          "tag": "9.2",
          "commit": "150eba8eb37e5f196c7dedd4b2af3bbda89a6365"
        },
        {
          "type": "file",
          "url": "http://stuff.ardour.org/loops/ArdourBundledMedia.zip",
          "sha256": "a00de00671cdc329b2ca35c2a5c4150af3d6588147f9dca2e3dea752aa2e234c"
        },
        {
          "type": "patch",
          "path": "patches/ardour7-7.2-appdata-flatpak.patch"
        }
      ]
    }
  ]
}
